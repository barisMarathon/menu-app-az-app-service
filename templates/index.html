<!DOCTYPE html>
<html>
  <head>
    <title>Terraform Autodeploy</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 20px;
      }

      .main-container {
        display: flex;
        gap: 250px;
        max-width: 1400px;
        margin: 0 auto;
        align-items: flex-start;
        padding-left: 10px;
      }

      .left-panel {
        flex: 0 0 450px;
        min-width: 400px;
        max-width: 500px;
        margin-left: 0;
      }

      .right-panel {
        flex: 1;
        min-width: 500px;
        background-color: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        padding: 20px;
        height: fit-content;
        position: sticky;
        top: 20px;
        margin-left: 30px;
      }

      .container {
        background-color: #fff;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        text-align: left;
        width: 100%;
        margin-bottom: 20px;
      }

      /* Mobile and tablet styles */
      @media (max-width: 1024px) {
        .main-container {
          flex-direction: column;
          align-items: center;
        }

        .left-panel {
          max-width: 600px;
          width: 100%;
        }

        .right-panel {
          max-width: 600px;
          width: 100%;
          position: static;
          margin-left: 0;
        }

        .container {
          text-align: center;
        }
      }

      h1 {
        font-size: 24px;
        margin-bottom: 24px;
        color: #333;
        text-align: center;
      }

      h2 {
        font-size: 20px;
        margin-bottom: 16px;
        color: #333;
        text-align: center;
      }

      input[type="text"] {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
      }

      select {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        background-color: white;
        box-sizing: border-box;
      }

      textarea {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        min-height: 100px;
        resize: vertical;
        box-sizing: border-box;
      }

      input[type="file"] {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        background-color: white;
        box-sizing: border-box;
      }

      button {
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        background-color: #4a90e2;
        color: white;
        cursor: pointer;
        margin-top: 10px;
        width: 100%;
      }

      button:hover {
        background-color: #357ab8;
      }

      .inline-button {
        width: auto;
        display: inline-block;
        margin: 5px;
      }

      a {
        color: #4a90e2;
        text-decoration: none;
        font-weight: bold;
      }

      a:hover {
        text-decoration: underline;
      }

      p {
        margin-top: 20px;
        font-size: 16px;
      }

      .response-box {
        margin: 20px 0;
        padding: 15px;
        border-radius: 8px;
        word-wrap: break-word;
      }

      .ai-response {
        background-color: #f0f8ff;
      }

      .gpt-vision-response {
        background-color: #f0fff0;
      }

      .preview-title {
        font-size: 18px;
        margin-bottom: 16px;
        color: #333;
        text-align: center;
        border-bottom: 2px solid #4a90e2;
        padding-bottom: 10px;
      }

      .preview-content {
        min-height: 600px;
        border: 2px dashed #ddd;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-style: italic;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .preview-iframe {
        width: 100%;
        height: 600px;
        border: none;
        border-radius: 8px;
        background: white;
      }

      .preview-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .preview-url {
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 6px;
        font-size: 12px;
        word-break: break-all;
      }

      .preview-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        justify-content: center;
      }

      .preview-btn {
        padding: 6px 12px;
        font-size: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      .preview-btn:hover {
        background: #f0f0f0;
      }

      .preview-btn.active {
        background: #4a90e2;
        color: white;
        border-color: #4a90e2;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- Left Panel - Controls -->
      <div class="left-panel">
        <div class="container">
          <h1>AI Website Generator & Deployer</h1>

          <!-- AI Prompt Section -->
          <form method="POST" action="/">
            <h2>AI Text Prompt</h2>
            <textarea
              name="ai_prompt"
              placeholder="Enter your AI prompt here..."
              rows="4"
            ></textarea>
            <br />
            <button type="submit">Generate Website</button>
          </form>

          {% if ai_response %}
          <div class="response-box ai-response">
            <strong>AI Response:</strong><br />
            {{ ai_response }} {% if ai_response and "View at:" in ai_response %}
            {% set url_parts = ai_response.split("View at:") %} {% if
            url_parts|length > 1 %}
            <div
              style="
                margin-top: 15px;
                padding-top: 10px;
                border-top: 1px solid #ddd;
              "
            >
              <strong>Quick Deploy:</strong><br />
              <form method="POST" action="/" style="display: inline">
                <input
                  type="hidden"
                  name="github_url"
                  value="{{ url_parts[1].strip() }}"
                />
                <button
                  type="submit"
                  class="inline-button"
                  style="padding: 8px 16px; font-size: 14px; margin-top: 5px"
                >
                  Deploy This Page
                </button>
              </form>
            </div>
            {% endif %} {% endif %}
          </div>
          {% endif %}
        </div>

        <div class="container">
          <!-- GPT Vision Section -->
          <form method="POST" action="/" enctype="multipart/form-data">
            <h2>Generate from Restaurant Image</h2>
            <input type="file" name="image_file" accept="image/*" required />
            <br />
            <textarea
              name="image_prompt"
              placeholder="Optional: Additional instructions (e.g., 'Use modern colors', 'Add contact section', etc.)"
              rows="2"
            ></textarea>
            <br />
            <button type="submit">Generate Restaurant Website</button>
          </form>

          {% if gpt_vision_response %}
          <div class="response-box gpt-vision-response">
            <strong>Restaurant Website:</strong><br />
            {{ gpt_vision_response }} {% if gpt_vision_response and "View at:"
            in gpt_vision_response %} {% set url_parts =
            gpt_vision_response.split("View at:") %} {% if url_parts|length > 1
            %}
            <div
              style="
                margin-top: 15px;
                padding-top: 10px;
                border-top: 1px solid #ddd;
              "
            >
              <strong>Quick Deploy:</strong><br />
              <form method="POST" action="/" style="display: inline">
                <input
                  type="hidden"
                  name="github_url"
                  value="{{ url_parts[1].strip() }}"
                />
                <button
                  type="submit"
                  class="inline-button"
                  style="padding: 8px 16px; font-size: 14px; margin-top: 5px"
                >
                  Deploy This Page
                </button>
              </form>
            </div>
            {% endif %} {% endif %}
          </div>
          {% endif %}
        </div>

        <div class="container">
          <!-- GitHub Deployment Section -->
          <form method="POST" action="/">
            <h2>Deploy from GitHub</h2>
            <input
              type="text"
              name="github_url"
              placeholder="GitHub repository URL or individual HTML file URL"
            />
            <br />
            <small style="color: #666; font-size: 12px">
              Supports both repository URLs and individual HTML file URLs
            </small>
            <br />
            <button type="submit">Deploy</button>
          </form>

          {% if vm_ip %}
          <p>
            <strong>VM Live:</strong>
            <a href="{{ vm_ip }}" target="_blank">{{ vm_ip }}</a>
          </p>
          {% endif %}

          <form method="POST" action="/destroy">
            <button type="submit" style="background-color: #e74c3c">
              Destroy VM
            </button>
          </form>

          {% if message %}
          <p>{{ message }}</p>
          {% endif %}
        </div>
      </div>

      <!-- Right Panel - Preview -->
      <div class="right-panel">
        <div class="preview-title">Website Preview</div>

        {% if vm_ip or (ai_response and "View at:" in ai_response) or
        (gpt_vision_response and "View at:" in gpt_vision_response) %} {% set
        preview_url = vm_ip %} {% if ai_response and "View at:" in ai_response
        %} {% set url_parts = ai_response.split("View at:") %} {% if
        url_parts|length > 1 %} {% set github_url = url_parts[1].strip() %} {%
        set preview_url = "https://htmlpreview.github.io/?" + github_url %} {%
        endif %} {% endif %} {% if gpt_vision_response and "View at:" in
        gpt_vision_response %} {% set url_parts =
        gpt_vision_response.split("View at:") %} {% if url_parts|length > 1 %}
        {% set github_url = url_parts[1].strip() %} {% set preview_url =
        "https://htmlpreview.github.io/?" + github_url %} {% endif %} {% endif
        %}

        <div class="preview-controls">
          <button class="preview-btn active" onclick="switchPreview('desktop')">
            🖥️ Desktop
          </button>
          <button class="preview-btn" onclick="switchPreview('tablet')">
            📱 Tablet
          </button>
          <button class="preview-btn" onclick="switchPreview('mobile')">
            📱 Mobile
          </button>
        </div>

        <div class="preview-content" id="preview-container">
          <iframe
            id="preview-iframe"
            class="preview-iframe"
            src="{{ preview_url }}"
            onload="hideLoading()"
            onerror="showPreviewError()"
          ></iframe>
          <div class="preview-loading" id="preview-loading">
            <div>Loading preview...</div>
          </div>
        </div>

        {% if preview_url %}
        <div class="preview-url">
          <strong>Preview URL:</strong><br />
          <a href="{{ preview_url }}" target="_blank">{{ preview_url }}</a>
        </div>
        {% endif %} {% else %}

        <div class="preview-content">
          <div>
            Preview will appear here when you generate or deploy a website.<br /><br />
            <small
              >📱 On mobile devices, this preview will appear below the
              controls.</small
            >
          </div>
        </div>

        {% endif %}

        <script>
          function switchPreview(size) {
            const iframe = document.getElementById("preview-iframe");
            const buttons = document.querySelectorAll(".preview-btn");

            // Remove active class from all buttons
            buttons.forEach((btn) => btn.classList.remove("active"));

            // Add active class to clicked button
            event.target.classList.add("active");

            // Adjust iframe size based on selection
            switch (size) {
              case "desktop":
                iframe.style.width = "100%";
                iframe.style.height = "600px";
                break;
              case "tablet":
                iframe.style.width = "768px";
                iframe.style.height = "600px";
                iframe.style.margin = "0 auto";
                iframe.style.display = "block";
                break;
              case "mobile":
                iframe.style.width = "375px";
                iframe.style.height = "600px";
                iframe.style.margin = "0 auto";
                iframe.style.display = "block";
                break;
            }
          }

          function hideLoading() {
            const loading = document.getElementById("preview-loading");
            if (loading) {
              loading.style.display = "none";
            }
          }

          function showPreviewError() {
            const container = document.getElementById("preview-container");
            const iframe = document.getElementById("preview-iframe");
            if (container && iframe) {
              container.innerHTML = `
                <div style="padding: 40px; text-align: center; color: #666;">
                  <h3>Preview Not Available</h3>
                  <p>GitHub HTML files cannot be previewed directly in iframe.</p>
                  <br>
                  <a href="${iframe.src}" target="_blank" 
                     style="background: #4a90e2; color: white; padding: 12px 24px; 
                            text-decoration: none; border-radius: 8px; display: inline-block;">
                    🚀 View Full Website →
                  </a>
                  <br><br>
                  <small style="color: #999;">
                    The website is working perfectly - just click above to view it!
                  </small>
                </div>
              `;
            }
          }

          // Auto-refresh preview every 30 seconds if there's a URL
          const iframe = document.getElementById("preview-iframe");
          if (iframe && iframe.src) {
            // Try to detect if iframe fails to load after 5 seconds
            setTimeout(() => {
              try {
                if (!iframe.contentDocument && !iframe.contentWindow) {
                  showPreviewError();
                }
              } catch (e) {
                // Cross-origin restrictions - this is normal for GitHub
                console.log("Cross-origin iframe detected");
              }
            }, 5000);

            setInterval(() => {
              iframe.src = iframe.src;
            }, 30000);
          }
        </script>
      </div>
    </div>
  </body>
</html>
